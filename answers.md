# Datadog Solutions Engineer Exercise
A technical exercise for the Solutions Engineering interview process at Datadog.

Datadog is a cloud-scale monitoring service that creates a single pane of glass
for the metrics and events generated by modern software solutions. Those
solutions can span numerous cloud and service providers with SOA and
micro-service architectures where messaging, queuing, caching, routing, and
service discovery are critical working components. These resources can be
configured and deployed in a host of ways, from containers, to virtual machines,
to bare metal.

Datadog boasts a huge library of integrations that allows customers to get
metrics into their system quickly and easily from almost any source, be it an
application, a database, tooling, a cloud provider, or third party services. And
with an API first approach developers can build custom integrations and push
custom metrics with ease. Even Graphs and Dashboards can be codified!

Datadog doesn't stop there. Real-time interactive dashboards enable customers to
quickly correlate data from all these sources and check the overall health of
their environments. Datadog can be configured to alert customers before
something goes wrong and operations teams can discuss in real-time about what
they are seeing within the dashboard itself. This keeps the context and history
relevant to the metrics at that moment in time.

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
## Table of Contents

- [Setup an Ubuntu VM](#setup-an-ubuntu-vm)
- [Collecting Data](#collecting-data)
  - [Installing the Agent on Ubuntu](#installing-the-agent-on-ubuntu)
  - [Tagging](#tagging)
  - [Installing & Monitoring MongoDB](#installing--monitoring-mongodb)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Setup an Ubuntu VM
[Vagrant](https://www.vagrantup.com/) is a tool for building and managing
virtual machine environments. Vagrant provides easy to configure, reproducible,
and portable work environments built on top of industry-standard technology.

To get started with Vagrant follow the instruction set below:

- [Install Vagrant](https://www.vagrantup.com/docs/installation/) for your
specific operating system.
- [Install VirtualBox](https://www.virtualbox.org/wiki/Downloads); VirtualBox is
a general-purpose full virtualizer for x86 hardware, targeted at server, desktop
and embedded use.
- Clone this repository to your local workstation: `git clone
https://github.com/ckelner/hiring-engineers.git`
- Now run `vagrant up` from your terminal in this directory. This will add an
Ubuntu 12.04 Vagrant Box to your local workstation if you don't have it already.
A Box is simply a base virtual machine image to work with. Vagrant will then
boot a virtual machine using this image and any customizations found in the
`Vagrantfile` in this project. You'll know that it is successful if you see the
message `No Datadog API key found. Make sure 'secrets.yaml' exists. VM will
come up without Datadog agent installed.` -- we will address this in the next
session, but for now that is fine.
- You can SSH into your virtual machine by running `vagrant ssh`; you will see a
message similar to `Welcome to your Vagrant-built virtual machine` and you'll be
dropped to the VM's command prompt.

# Collecting Data
> Bonus question: In your own words, what is the Agent?

Data is at the core of all monitoring solutions. Datadog has a few ways to
collect data. The primary means is via an agent. The Datadog agent is a piece of
software that collects metrics and alerts and pushes them back to Datadog on
your behalf. Typically these are system level metrics (CPU, memory, disk) but
can also include custom application metrics as well.

## Installing the Agent on Ubuntu
Datadog offers step-by-step guides for the majority of common operating system
platforms which can be found
[here](https://app.datadoghq.com/account/settings#agent). For each there is
typically a one-line install snippet that can be used, typically this will only
apply when doing operations by hand. As an example, for our target platform
of Ubuntu, that looks like:

```bash
DD_API_KEY=$YOUR_API_KEY_HERE bash -c "$(curl -L https://raw.githubusercontent.com/DataDog/dd-agent/master/packaging/datadog-agent/source/install_agent.sh)"
```

For a more controlled and automated approach Datadog list the step-by-step
instructions as well. The [`Vagrantfile`](Vagrantfile) in this repo has adopted
those instructions to install the agent via a
[provisioner](https://www.vagrantup.com/docs/provisioning/). To take advantage
of this provisioner and install the Datadog agent when you run `vagrant up`
or `vagrant provision` you need to do the following:

- In this directory copy [`secrets.yaml.example`](secrets.yaml.example) to
  `secrets.yaml`.
  - `secrets.yaml` is never checked into source control as it is ignored through
  [`.gitignore`](.gitignore).
- Replace the `$YOUR_API_KEY_GOES_HERE` value with the real one from Datadog.
- If you still have your vagrant box running you can do `vagrant provision` and
you should see the provisioner run and install the agent. You can now go to
your [Infrastructure Host Map](https://app.datadoghq.com/infrastructure/map) to
see the agent reporting from the VM.

## Tagging
> Add tags in the Agent config file and show us a screenshot of your host and
> its tags on the Host Map page in Datadog.

[Tags](http://docs.datadoghq.com/guides/tagging/) make it easier to collect,
query, and filter for those resources which share the same tags. Tags can be
assigned via the UI, the API, the agent configuration, or inherited from an
integration.

For this project the tags are modified in the agent configuration with the
values defined in `tags.yaml`. This is automated through the
[`Vagrantfile`](Vagrantfile) provisioner. You can modify the tags in
[`tags.yaml`](tags.yaml) then run `vagrant provision` and it will alter the tags
in the agent config. It will take a few minutes to update in the
[Datadog UI](https://app.datadoghq.com/infrastructure/map).

Below is a screenshot of the default tags that will be applied to the host:
![tag image](screenshots/tags.png)

## Installing & Monitoring MongoDB
> Install a database on your machine (MongoDB, MySQL, or PostgreSQL) and then
> install the respective Datadog integration for that database.

This task we'll do via a script rather than the [`Vagrantfile`](Vagrantfile)
provisioner. Perform the following steps:

- If the vagrant VM isn't already running then `vagrant up`
- `vagrant ssh`
- `bash /vagrant_data/mongo-install.sh`
- The [scripts/mongo-install.sh](scripts/mongo-install.sh) will install mongodb,
configure the datadog database user, and configure the datadog-agent to be mongo
aware.
- The last command in the script is `sudo /etc/init.d/datadog-agent info` which
will display what checks are running. There should be a mongo check similar to
the one below:
  ```
  Checks
  ======
  ...
      mongo (5.13.2)
      --------------
        - instance #0 [OK]
        - Collected 112 metrics, 0 events & 1 service check
        - Dependencies:
            - pymongo: 3.2
  ```

And now when you revisit your
[Hostmap](https://app.datadoghq.com/infrastructure/map) you'll see that mongodb
metrics are reporting:
![mongo-metrics](screenshots/mongo.png)

